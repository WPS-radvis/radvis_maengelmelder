@if (showMap) {
  <div class="karte">

    <div class="karte-body">
      @if (!hasLocation()) {
        <div class="radmelder-hinweis">
          <mat-icon class="hinweis-icon">info_outline</mat-icon>
          <span>Wählen Sie einen Standort aus oder verwenden Sie Ihren aktuellen Standort.</span>
        </div>
      }

      @if (errorMessage) {
        <mat-card class="error-card">
          <div class="error-content">
            <mat-icon class="error-icon">error_outline</mat-icon>
            <span>{{ errorMessage }}</span>
          </div>
        </mat-card>
      }

      <!-- Map -->
      <div class="map-container">
      <div
        leaflet
        [leafletOptions]="options"
        (leafletMapReady)="onMapReady($event)"
        style="height: 400px; width: 100%"
      ></div>

        <button
          mat-raised-button
          type="button"
          class="map-locate-button"
          (click)="useCurrentLocation()"
          [disabled]="isLoadingLocation"
          aria-label="Aktuellen Standort verwenden"
          matTooltip="Aktuellen Standort wählen"
          matTooltipPosition="below"
          matTooltipClass="map-tooltip"
        >
          <span class="map-locate-glyph"></span>
        </button>
      </div>

      @if (hasLocation()) {
        <div class="success-box">
          ✓ Standort ausgewählt: {{ formattedLat }}, {{ formattedLng }}
        </div>
      }

      <button
        mat-raised-button
        class="map-action-button"
        (click)="goToForm()"
        [disabled]="!reportState.hasLocation()"
      >
        Meldung verfassen
      </button>
    </div>
  </div>
}
