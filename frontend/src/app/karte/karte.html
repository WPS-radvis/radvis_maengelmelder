@if (showMap) {
  <div class="karte">

    <div class="karte-body">
      @if (!hasLocation()) {
        <div class="radmelder-hinweis">
          <mat-icon class="hinweis-icon">info_outline</mat-icon>
          <span>Wählen Sie einen Standort aus oder verwenden Sie Ihren aktuellen Standort.</span>
        </div>
      }

      @if (errorMessage) {
        <mat-card class="error-card">
          <div class="error-content">
            <mat-icon class="error-icon">error_outline</mat-icon>
            <span>{{ errorMessage }}</span>
          </div>
        </mat-card>
      }

      <button
        mat-raised-button
        style="margin-bottom: 3%"
        color="primary"
        (click)="useCurrentLocation()"
        [disabled]="isLoadingLocation"
      >
        {{ isLoadingLocation ? 'Standort wird ermittelt...' : 'Aktuellen Standort verwenden' }}
      </button>

      <!-- Map -->
      <div
        leaflet
        [leafletOptions]="options"
        (leafletMapReady)="onMapReady($event)"
        style="height: 400px; width: 100%"
      ></div>

      @if (hasLocation()) {
        <div class="success-box">
          ✓ Standort ausgewählt: {{ formattedLat }}, {{ formattedLng }}
        </div>
      }

      <button
        mat-raised-button
        class="map-action-button"
        (click)="goToForm()"
        [disabled]="!reportState.hasLocation()"
      >
        Meldung verfassen
      </button>
    </div>
  </div>
}
